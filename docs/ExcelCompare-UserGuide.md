# Excel比較機能 ユーザーガイド

## 概要

Excel比較機能は、2つのExcelファイルの指定セルを比較し、結果を表示・CSV出力できる機能です。テンプレート機能により、比較設定を保存・再利用できます。

## アクセス

```
http://サーバー名/MesWEB/excel-compare
```

## 基本的な使い方

### 1. Excelファイルのアップロード

1. 「ファイルを選択」ボタンをクリック
2. 比較したいExcelファイルを選択（.xlsx または .xls）
3. 複数ファイルを同時にアップロード可能

**サポートファイル形式:**
- `.xlsx` (Excel 2007以降)
- `.xls` (Excel 2003以前)

### 2. セル対応表の作成

#### 項目を手動で追加

1. 画面右下の「➕ 項目を追加」ボタンをクリック
2. 以下の情報を入力：
   - **項目名**: 比較項目の名前（例: 温度、圧力）
   - **ブック1**: 比較元のファイル名を選択
   - **シート1**: 比較元のシート名を入力
   - **セル1**: 比較元のセルアドレス（例: A1, B5:B10）
   - **数式1**: セル範囲の集計方法（なし/最大値/最小値/平均値）
   - **ブック2**: 比較先のファイル名を選択
   - **シート2**: 比較先のシート名を入力
   - **セル2**: 比較先のセルアドレス
   - **数式2**: セル範囲の集計方法
   - **小数桁数**: 数値比較の丸め桁数（0～10）
   - **許容誤差**: 数値比較の許容範囲（±）

3. 「保存」ボタンで項目を追加

#### テンプレートから読み込み

1. 「📋 テンプレートから読み込み」ボタンをクリック
2. 保存済みテンプレートを選択
   - テンプレートは**ラベル（カテゴリ）**ごとに整理されています
   - ラベルをクリックすると、そのラベル内のテンプレート一覧が表示されます
   - **未分類**にはラベルに属さないテンプレートが表示されます
3. テンプレートを選択
4. 「読み込み」ボタンで設定を復元

### 3. 比較の実行

1. 「🔍 比較実行」ボタンをクリック
2. 比較結果が表示されます

**比較結果の表示:**
- ✅ **一致**: 緑色で表示
- ❌ **不一致**: 赤色で表示
- 各項目にブック1とブック2の値が表示されます

### 4. 結果のエクスポート

「📥 CSV出力」ボタンをクリックすると、比較結果をCSVファイルでダウンロードできます。

**CSVファイルの内容:**
- 項目名
- ブック1・ブック2のファイル名、シート名、セルアドレス
- ブック1・ブック2の値
- 比較結果（一致/不一致）

## テンプレート機能

### テンプレートの保存

1. セル対応表を作成
2. 「💾 テンプレートに保存」ボタンをクリック
3. テンプレート名と説明を入力
4. **ラベル（カテゴリ）**を選択（オプション）
   - ラベルを選択すると、テンプレートがそのカテゴリに分類されます
   - 選択しない場合は「未分類」になります
5. 「新規保存」または「上書き保存」を選択
6. 「保存」ボタンで保存

**注意:**
- 上書き保存は既存のテンプレートを完全に置き換えます
- ファイル名は保存されますが、ファイル自体はアップロードし直す必要があります

### テンプレートの読み込み

1. 「📋 テンプレートから読み込み」ボタンをクリック
2. ラベルツリーからテンプレートを選択
   - **ラベル（カテゴリ）**をクリックするとテンプレート一覧が展開されます
   - 各ラベルには属するテンプレート数が表示されます（例: 装置A (5)）
   - **未分類**セクションにはラベルに属さないテンプレートが表示されます
3. 目的のテンプレートを選択
4. 「読み込み」ボタンで設定を復元

**自動マッチング:**
- テンプレートに保存されたファイル名と、アップロード済みのファイル名が一致する場合、自動的に関連付けられます
- 大文字小文字は区別されません

### ラベル（カテゴリ）について

ラベルは、テンプレートをグループ化するためのカテゴリ機能です。

**ラベルの利点:**
- テンプレートを装置別、プロジェクト別などで整理できます
- 大量のテンプレートを管理しやすくなります
- 関連するテンプレートをすばやく見つけられます

**ラベルの例:**
- 装置A、装置B、装置C
- プロジェクトX、プロジェクトY
- 日次チェック、週次チェック
- 製品A、製品B

**ラベルの管理:**

ラベルの作成・編集・削除は「セルマッピングテンプレート管理」ページで行います。

```
http://サーバー名/MesWEB/cell-mapping/templates
```

詳細は「セルマッピングテンプレート管理 ユーザーガイド」を参照してください。

## テンプレート管理ページとの連携

Excel比較ページで作成したテンプレートは、セルマッピングテンプレート管理ページで詳細な管理ができます。

**管理ページでできること:**
- ラベル（カテゴリ）の作成・編集・削除
- テンプレートの名前・説明の変更
- テンプレートのラベル間移動
- テンプレートの削除
- ツリー構造での一覧表示

**操作の流れ:**
1. Excel比較ページでテンプレートを保存
2. テンプレート管理ページでラベルを作成
3. テンプレートをラベルに移動して整理
4. Excel比較ページでラベル別にテンプレートを読み込み

## よくある質問

### Q: テンプレートにファイル自体は保存されますか？

A: いいえ。ファイル名のみが保存されます。毎回ファイルをアップロードする必要があります。

### Q: ラベルを使わずにテンプレートを保存できますか？

A: はい。ラベルを選択せずに保存すると「未分類」として保存されます。後からテンプレート管理ページでラベルに移動できます。

### Q: 1つのラベルにいくつまでテンプレートを登録できますか？

A: 制限はありませんが、管理しやすい数（10～20程度）に抑えることを推奨します。

### Q: テンプレートを別のラベルに移動するには？

A: セルマッピングテンプレート管理ページで移動できます。Excel比較ページからは移動できません。

### Q: ラベルツリーが表示されない

A: データベース接続エラーまたはテンプレートが1つも存在しない可能性があります。先にテンプレートを1つ以上作成してください。

## 使用例

### 例1: テンプレートを使った定期比較

1. 初回：セル対応表を作成してテンプレートに保存
   - テンプレート名: 「装置A 日次チェック」
   - ラベル: 「装置A」を選択

2. 次回以降：
   - 新しいファイルをアップロード
   - テンプレートから読み込み（ラベル「装置A」から選択）
   - 一括変換でファイル名を更新
   - 比較実行

### 例2: 複数装置のテンプレートを整理

1. テンプレート管理ページでラベルを作成
   - 装置A、装置B、装置C

2. 既存のテンプレートを各ラベルに移動

3. Excel比較ページでラベル別にテンプレートを使い分け
   - 装置Aの比較 → ラベル「装置A」から選択
   - 装置Bの比較 → ラベル「装置B」から選択

## ワークフロー例

### 日常的な比較作業

```
1. ファイルをアップロード
   ↓
2. テンプレートを読み込み（ラベルから選択）
   ↓
3. 一括変換でファイル名を更新（必要に応じて）
   ↓
4. 比較実行
   ↓
5. 結果をCSV出力
```

### 新しい比較設定の作成

```
1. ファイルをアップロード
   ↓
2. セル対応表を手動で作成
   ↓
3. テンプレートに保存（ラベルを指定）
   ↓
4. 比較実行
   ↓
5. テンプレート管理ページで整理（必要に応じて）
```

## 関連ドキュメント

- [セルマッピングテンプレート管理 ユーザーガイド](CellMappingTemplates-UserGuide.md) - ラベルとテンプレートの詳細管理
- [TERMINOLOGY.md](../TERMINOLOGY.md) - 用語集
- [README.md](../README.md) - プロジェクト概要

## サポート

問題が解決しない場合は、生産技術グループまでお問い合わせください。
